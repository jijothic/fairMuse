"use strict";var fairMuse=angular.module("fairMuseApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ui.bootstrap","com.2fdevs.videogular","com.2fdevs.videogular.plugins.controls","ngFileUpload","flash"]).factory("authInterceptor",["$q","$location",function(a,b){return{request:function(a){return a.headers=a.headers||{},localStorage.auth_token&&(a.headers.token=localStorage.auth_token),a},responseError:function(c){return 401===c.status&&b.path("/login"),a.reject(c)}}}]).config(["$httpProvider",function(a){a.interceptors.push("authInterceptor")}]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).when("/artistsignup",{templateUrl:"views/artist_signup.html",controller:"ArtistSignUpCtrl",controllerAs:"artistSignup"}).when("/artistsignin",{templateUrl:"views/artist_signin.html",controller:"ArtistSigninCtrl",controllerAs:"artistSignin"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl",controllerAs:"about"}).when("/success",{templateUrl:"views/success.html",controller:"MainCtrl",controllerAs:"main"}).when("/signup",{templateUrl:"views/signup.html",controller:"SignupCtrl",controllerAs:"signup"}).when("/useraccount",{templateUrl:"views/user_account.html",controller:"UserCtrl",controllerAs:"user"}).when("/upload",{templateUrl:"views/upload.html",controller:"UploadCtrl",controllerAs:"upload"}).when("/artistaccount",{templateUrl:"views/artist_account.html",controller:"ArtistAccountCtrl",controllerAs:"artistAccount"}).when("/subscribe",{templateUrl:"views/subscribe.html",controller:"MainCtrl",controllerAs:"main"}).otherwise({redirectTo:"/"})}]);angular.module("fairMuseApp").controller("MainCtrl",function(){var a=this;a.user=localStorage.getItem("user_id")}),angular.module("fairMuseApp").controller("AboutCtrl",["$http",function(a){}]),fairMuse.controller("PlayerCtrl",["$sce","streamTrackingService","TracksService",function(a,b,c){var b,d=this;this.tracks=c.query(function(){d.songList=[];for(var c=0;c<=d.tracks.length-1;c++)d.songList.push({songId:c+1,name:d.tracks[c].name,genre:d.tracks[c].genre,image:d.tracks[c].image_url,artist_id:d.tracks[c].artist_id,artist_name:d.tracks[c].artist_name,sources:[{src:a.trustAsResourceUrl(d.tracks[c].track_url),type:d.tracks[c].file_content_type,name:d.tracks[c].name}]});d.config={theme:{url:"http://www.videogular.com/styles/themes/default/latest/videogular.css"}},d.getSong=function(a){for(var b=0;b<this.songList.length;b++)if(this.songList[b].songId===a)return this.songList[b].sources},d.changeSource=function(a){this.config.sources=this.getSong(a),b.track(a)},d.currentSongName=function(){return this.config.sources?this.config.sources[0].name:void 0}})}]),fairMuse.controller("UploadCtrl",["Upload","$timeout","$location","$window",function(a,b,c,d){var c=c,d=d;this.uploadSong=function(e,f){e.upload=a.upload({url:"https://fast-meadow-84804.herokuapp.com/tracks",data:{track:{name:this.trackName,genre:this.genre,file:e,image:f,artist_id:localStorage.getItem("artist_id"),artist_name:localStorage.getItem("name")}}}),e.upload.then(function(a){b(function(){e.result=a.data,d.location.reload(),c.path("/artistaccount")})},function(a){a.status>0&&(this.errorMsg=a.status+": "+a.data)},function(a){e.progress=Math.min(100,parseInt(100*a.loaded/a.total))})}}]),angular.module("fairMuseApp").controller("LoginCtrl",["authenticationService","flash","$location","$uibModalInstance",function(a,b,c,d){var a,e,f=this;e=c,f.email="",f.password="",f.cancel_it=function(){d.close()},f.sendForm=function(b,c){f.user={email:f.email,password:f.password};var d=a.login(f.user);d.then(g,h)};var g=function(a){localStorage.setItem("auth_token",a.data.auth_token),localStorage.setItem("user_id",a.data.user_id),localStorage.setItem("is_user",a.data.is_user),e.path("/songs")},h=function(a){b("error","Wrong Login Credentials!")}}]),fairMuse.controller("ModalCtrl",["$uibModal",function(a){this.animationsEnabled=!0,this.open=function(b,c){a.open({animation:this.animationsEnabled,templateUrl:"views/"+b,controller:c})}}]),fairMuse.controller("UserCtrl",["$http",function(a){a.get("https://fast-meadow-84804.herokuapp.com/users");var b=this;b.pay=function(){a.post("https://fast-meadow-84804.herokuapp.com/api/payment",{user_id:localStorage.getItem("user_id")})},b.displayStreamDetails=function(){var a=b.getStreamDetails();a.then(c,d)},b.getStreamDetails=function(){return a.post("https://fast-meadow-84804.herokuapp.com/api/streaminfo",{user_id:localStorage.getItem("user_id")})};var c=function(a){b.returnData=a.data},d=function(a){flash("Wrong!")}}]),fairMuse.controller("IndexCtrl",["$location","authenticationService",function(a,b){var b=b;this.LoggedIn=b.isLoggedIn(),this.isUser=localStorage.getItem("is_user"),this.isArtist=localStorage.getItem("is_artist"),this.testbutton=function(){console.log("is user"+localStorage.getItem("is_user")),console.log("is artist"+localStorage.getItem("is_artist")),console.log("auth token"+localStorage.getItem("auth_token"))},this.clearLocalStorage=function(){localStorage.clear(),localStorage.removeItem("artist_id")},this.LogOut=function(){var c=b.LogOut();c.then(function(){localStorage.removeItem("auth_token"),localStorage.removeItem("user_id"),localStorage.removeItem("is_user"),a.path("/views/main.html")})},this.bob=function(){var c=b.artistLogout();c.then(function(){localStorage.removeItem("auth_token"),localStorage.removeItem("artist_id"),localStorage.removeItem("is_artist"),a.path("/views/main.html")})}}]),angular.module("fairMuseApp").controller("SignupCtrl",["signupService","flash","$location","$uibModalInstance",function(a,b,c,d){var e,f=this;e=c,f.cancel_it=function(){d.close()},f.sendForm=function(b,c){f.userInfo={email:f.email,password:f.password,password_confirmation:f.password_confirmation};var d=a.signup(f.userInfo);d.then(g,h)};var g=function(a){localStorage.setItem("auth_token",a.data.auth_token),localStorage.setItem("user_id",a.data.user_id),localStorage.setItem("is_user",a.data.is_user),e.path("/subscribe")},h=function(a){b(a.data.messages)}}]),fairMuse.controller("MyCarouselController",function(){this.myInterval=5e3,this.noWrapSlides=!1,this.active=0;var a=["http://img.gawkerassets.com/img/17vzbduvh99gnjpg/original.jpg","https://whileyouweresleeping.files.wordpress.com/2015/04/maxresdefault.jpg"],b=this.slides=[],c=0;this.addSlide=function(){b.push({image:a[c],text:["Place","Holder","For","Proposition"][b.length%4],id:c++})};for(var d=0;2>d;d++)this.addSlide()}),angular.module("fairMuseApp").controller("ArtistSignUpCtrl",["signupService","flash","$location","$http","$window","$uibModalInstance",function(a,b,c,d,e,f){var g,h=this;g=c,h.cancel_it=function(){f.close()},this.artistId=localStorage.getItem("artist_id"),this.artistName=localStorage.getItem("name"),h.sendSignUpForm=function(b,c){h.artistInfo={name:h.name,email:h.email,password:h.password,password_confirmation:h.password_confirmation};var d=a.artistSignup(h.artistInfo);d.then(i,j)};var i=function(a){localStorage.setItem("auth_token",a.data.auth_token),localStorage.setItem("artist_id",a.data.artist_id),localStorage.setItem("is_artist",a.data.is_artist),localStorage.setItem("name",a.data.name),g.path("/artistaccount")},j=function(a){b("Sign up failed!")}}]),angular.module("fairMuseApp").controller("ArtistSigninCtrl",["authenticationService","flash","$location","$uibModalInstance",function(a,b,c,d){var a,e,f=this;e=c,f.email="",f.password="",f.cancel_it=function(){d.close()},f.sendForm=function(b,c){f.artist={email:f.email,password:f.password};var d=a.artistLogin(f.artist);d.then(g,h)};var g=function(a){localStorage.setItem("auth_token",a.data.auth_token),localStorage.setItem("artist_id",a.data.artist_id),localStorage.setItem("is_artist",a.data.is_artist),localStorage.setItem("name",a.data.name),e.path("/artistaccount")},h=function(a){b("Wrong Login Credentials!")}}]),angular.module("fairMuseApp").controller("ArtistAccountCtrl",["$http","flash",function(a,b){var c=this;c.displayBalance=function(){var a=c.getBalance();a.then(d,e)},c.getBalance=function(){return a.post("https://fast-meadow-84804.herokuapp.com/api/balanceinfo",{artist_id:localStorage.getItem("artist_id")})};var d=function(a){c.balance=a.data},e=function(a){b("Wrong!")}}]),angular.module("fairMuseApp").service("signupService",["$http",function(a){this.signup=function(b){return a.post("https://fast-meadow-84804.herokuapp.com/api/signup",b)},this.artistSignup=function(b){return a.post("https://fast-meadow-84804.herokuapp.com/api/artistsignup",b)}}]),angular.module("fairMuseApp").service("authenticationService",["$http","$location",function(a,b){this.login=function(b){return a.post("https://fast-meadow-84804.herokuapp.com/api/login",b)},this.isLoggedIn=function(){return!!localStorage.getItem("auth_token")},this.LogOut=function(){return a["delete"]("https://fast-meadow-84804.herokuapp.com/api/logout.json")},this.artistLogin=function(b){return a.post("https://fast-meadow-84804.herokuapp.com/api/artistlogin",b)},this.artistLogout=function(){return a["delete"]("https://fast-meadow-84804.herokuapp.com/api/artistlogout.json")}}]),angular.module("fairMuseApp").service("streamTrackingService",["$http",function(a){var b;this.track=function(c){b={track_id:c,user_id:localStorage.getItem("user_id")},a.post("https://fast-meadow-84804.herokuapp.com/streams",b)}}]),fairMuse.service("TracksService",["$resource",function(a){return a("https://fast-meadow-84804.herokuapp.com/tracks")}]),angular.module("fairMuseApp").run(["$templateCache",function(a){a.put("views/about.html",'<div ng-include="\'views/navbar.html\'"></div> <div></div> <h2>Fair Music. For Real.</h2> <h4>We believe in fair payments for artists, helping them to create the music we love.</h4> <h4>If you want to help the artists whose music you enjoy, please contribute below.</h4> <form action="http://localhost:3000/charges" method="POST" class="form-horizontal" role="form"> <div class="form-group row"> <label for="amount" class="col-sm-2 col-sm-offset-2 control-label">Contribution</label> <div class="col-sm-6"> <input class="short_field" type="number" class="form-control" name="amount" value="amount"> </div> </div> <div class="form-group row"> <div class="col-sm-offset-4 col-sm-10"> <script src="https://checkout.stripe.com/checkout.js" class="stripe-button" data-key="pk_test_6pRNASCoBOKtIshFeQd4XMUh" data-image="/img/documentation/checkout/marketplace.png" data-name="Stripe.com" data-description="2 widgets" data-amount="" data-locale="auto"></script> </div> </div> </form>'),a.put("views/artist_account.html",'<div ng-include="\'views/navbar.html\'"></div> <div class="jumbotron front-hero"> <div class="row center-block"><button id="Click" ng-click="artistAccount.displayBalance()" class="btn"><div class="song_name">Update Balance</div></button><br>Current Balance: {{artistAccount.balance.balance}}</div> <h3>{{artistAccount.artistName}}</h3> <div> <flash:messages></flash:messages> </div> <div class="container"> <div class="row center-block"> <div ng-repeat="song in player.songList"> <div class="col-sm-4" ng-show="song.artist_id == artistAccount.artistId"> <div class="track_container center-block"> <div class="song_name"> {{song.name}} </div><img class="img_click" ng-src="{{song.image}}"></div> </div> </div> </div> </div> </div>'),a.put("views/artist_signin.html",'<div class="spacer"> </div> <h2>Artist Sign-In</h2> <div> <flash:messages></flash:messages> </div> <form name="login_form" ng-submit="artistSignin.sendForm(email, password)" class="form-horizontal" role="form"> <div class="form-group row"> <label for="email" class="col-sm-2 col-sm-offset-2 control-label">Email</label> <div class="col-sm-6"> <input class="short_field" type="email" class="form-control" name="email" ng-model="artistSignin.email"> </div> </div> <div class="form-group row"> <label for="password" class="col-sm-2 col-sm-offset-2 control-label">Password</label> <div class="col-sm-6"> <input class="short_field" type="password" class="form-control" name="password" ng-model="artistSignin.password"> </div> </div> <div class="form-group row"> <div class="col-sm-offset-4 col-sm-10"> <button type="submit" ng-click="artistSignin.cancel_it()" class="btn">Log in</button> </div> </div> </form>'),a.put("views/artist_signup.html",'<h2>Artist Sign-Up</h2> <div> <flash:messages></flash:messages> </div> <form name="signup_form" ng-submit="artistSignup.sendSignUpForm(email, password, password_confirmation)" class="form-horizontal" role="form"> <div class="form-group row"> <label for="email" class="col-sm-2 col-sm-offset-2 control-label">Artist Name</label> <div class="col-sm-6"> <input class="short_field" type="text" class="form-control" name="name" ng-model="artistSignup.name"> </div> </div> <div class="form-group row"> <label for="email" class="col-sm-2 col-sm-offset-2 control-label">Email</label> <div class="col-sm-6"> <input class="short_field" type="email" class="form-control" name="email" ng-model="artistSignup.email"> </div> </div> <div class="form-group row"> <label for="password" class="col-sm-2 col-sm-offset-2 control-label">Password</label> <div class="col-sm-6"> <input class="short_field" type="password" class="form-control" name="password" ng-model="artistSignup.password"> </div> </div> <div class="form-group row"> <label for="password_confirmation" class="col-sm-2 col-sm-offset-2 control-label">Password Confirmation</label> <div class="col-sm-6"> <input class="short_field" type="password" class="form-control" name="password_confirmation" ng-model="artistSignup.password_confirmation"> </div> </div> <div class="form-group row"> <div class="col-sm-offset-4 col-sm-10"> <button type="submit" ng-click="artistSignup.cancel_it()" class="btn">Sign up</button> </div> </div> </form>'),a.put("views/login.html",'<h2>User Log-In</h2> <div> <flash:messages></flash:messages> </div> <form name="login_form" ng-submit="login.sendForm(email, password)" class="form-horizontal" role="form"> <div class="form-group row"> <label for="email" class="col-sm-2 col-sm-offset-2 control-label">Email</label> <div class="col-sm-6"> <input class="short_field" type="email" class="form-control" name="email" ng-model="login.email"> </div> </div> <div class="form-group row"> <label for="password" class="col-sm-2 col-sm-offset-2 control-label">Password</label> <div class="col-sm-6"> <input class="short_field" type="password" class="form-control" name="password" ng-model="login.password"> </div> </div> <div class="form-group row"> <div class="col-sm-offset-4 col-sm-10"> <button type="submit" ng-click="login.cancel_it()" class="btn">Log in</button> </div> </div> </form>'),a.put("views/main.html",'<div ng-include="\'views/navbar.html\'"></div> <div class="jumbotron front-hero"> <section class="main"> <div class="my_carousel" ng-controller="MyCarouselController as myCarousel"> <div class="center_block"> <uib-carousel active="active" interval="myCarousel.myInterval" no-wrap="myCarousel.noWrapSlides"> <uib-slide ng-repeat="slide in myCarousel.slides track by slide.id" index="slide.id"> <img ng-src="{{slide.image}}" class="carousel_img"> <div class="carousel-caption"> <h1>FairMuse</h1> <div> <input id="search_bar" name="search_bar" type="text" ng-model="player.query" placeholder="search artist, genre, title..."> </div> </div> </uib-slide> </uib-carousel> </div> </div> </section> <h2 class="trending_text"> What is trending now - contribute to shape music </h2> <div class="container"> <div class="row center-block"> <div ng-repeat="song in player.songList | filter:player.query"> <div class="track_container col-sm-4"> <img class="img_click" ng-click="player.changeSource(song.songId)" ng-src="{{song.image}}"> <div class="song_name tracks_text">{{song.name}} - {{song.genre}} - {{song.artist_name}}<div> </div> </div> </div> </div> </div></div></div>'),a.put("views/navbar.html",'<div class="header"> <div class="navbar navbar-default" role="navigation"> <div class="container"> <div class="navbar-header"> <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#js-navbar-collapse"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <a class="navbar-brand" href="#/">fairMuse</a> </div> <div class="collapse navbar-collapse" id="js-navbar-collapse" ng-controller="IndexCtrl as index"> <ul class="nav navbar-nav"> <li><a href="#/">Home</a></li> <li ng-show="!index.isArtist"><a ng-href="#/about">About</a></li> <li ng-controller="ModalCtrl as modal"> <a ng-show="!index.LoggedIn" ng-click="modal.open(\'artist_signup.html\', \'ArtistSignUpCtrl as artistSignup\')">Artists Sign Up</a> </li> <li ng-controller="ModalCtrl as modal"> <a ng-show="!index.LoggedIn" ng-click="modal.open(\'artist_signin.html\', \'ArtistSigninCtrl as artistSignin\')">Artist Sign In</a> </li> <li ng-show="index.isUser"><a ng-href="#/useraccount">Account</a></li> <li ng-show="index.isArtist"><a ng-href="#/artistaccount">Account</a></li> <li ng-show="index.isArtist"><a ng-href="#/upload">Upload Sound</a></li> <li ng-controller="ModalCtrl as modal" ng-show="!index.LoggedIn"> <a ng-click="modal.open(\'signup.html\', \'SignupCtrl as signup\')">Sign up</a> </li> <li ng-controller="ModalCtrl as modal" ng-show="!index.LoggedIn"> <a ng-click="modal.open(\'login.html\', \'LoginCtrl as login\')">Log in</a> </li> <li ng-show="index.isUser"><a id="log_out" ng-click="index.LogOut()">Log out</a></li> <li ng-show="index.isArtist"><a id="artist_log_out" ng-click="index.bob()">Log out</a></li> </ul> </div> </div> </div> </div>'),a.put("views/player.html",'<div class="videogular-container"> <videogular vg-theme="player.config.theme.url" vg-clear-media-on-navigate="false" vg-auto-play="true" class="videogular-container audio"> <div><p id="song-name">{{player.currentSongName()}} </p></div> <vg-media vg-src="player.config.sources" vg-type="audio"></vg-media> <vg-controls> <vg-play-pause-button></vg-play-pause-button> <vg-time-display>{{ currentTime | date:\'mm:ss\':\'+0000\' }}</vg-time-display> <vg-scrub-bar> <vg-scrub-bar-current-time></vg-scrub-bar-current-time> </vg-scrub-bar> <vg-time-display>{{ timeLeft | date:\'mm:ss\':\'+0000\' }}</vg-time-display> <vg-volume> <vg-mute-button></vg-mute-button> <vg-volume-bar></vg-volume-bar> </vg-volume> </vg-controls> </videogular> </div>'),a.put("views/signup.html",'<h2>User Sign-Up</h2> <div> <flash:messages></flash:messages> </div> <form name="signup_form" ng-submit="signup.sendForm(email, password, password_confirmation)" class="form-horizontal" role="form"> <div class="form-group row"> <label for="email" class="col-sm-2 col-sm-offset-2 control-label">Email</label> <div class="col-sm-6"> <input class="short_field" type="email" class="form-control" name="email" ng-model="signup.email"> </div> </div> <div class="form-group row"> <label for="password" class="col-sm-2 col-sm-offset-2 control-label">Password</label> <div class="col-sm-6"> <input class="short_field" type="password" class="form-control" name="password" ng-model="signup.password"> </div> </div> <div class="form-group row"> <label for="password_confirmation" class="col-sm-2 col-sm-offset-2 control-label" name="password">Password Confirmation</label> <div class="col-sm-6"> <input class="short_field" type="password" class="form-control" name="password_confirmation" ng-model="signup.password_confirmation"> </div> </div> <div class="form-group row"> <div class="col-sm-offset-4 col-sm-10"> <button type="submit" ng-click="signup.cancel_it()" class="btn">Sign up </button> </div> </div> </form>'),a.put("views/subscribe.html",'<center><h1> Thanks for supporting real artists with real money</h1> <form action="http://localhost:3000/charges" method="POST" class="form-horizontal" role="form"> <input type="hidden" input name="user_id" input value="{{main.user}}"> <script src="https://checkout.stripe.com/checkout.js" class="stripe-button" data-key="pk_test_6pRNASCoBOKtIshFeQd4XMUh" data-image="/img/documentation/checkout/marketplace.png" data-name="FairMuse" data-description="FairMuse Subscription (£9 per month)" data-panel-label="Subscribe" data-label="Subscribe" data-locale="auto"></script> </form></center>'),a.put("views/success.html","<div ng-include=\"'views/navbar.html'\"></div> <p> Contribution Made! Thank You! </p>"),a.put("views/upload.html",'<div ng-include="\'views/navbar.html\'"></div> <div> <h1>Upload your track</h1> <form name="fileUploadForm" class="form-horizontal" role="form"> <div class="form-group row"> <label for="trackname" class="col-sm-2 col-sm-offset-2 control-label"> Track name: </label> <div class="col-sm-6"> <input class="short_field" type="text" class="form-control" name="trackname" ng-model="upload.trackName" size="31" required> <i ng-show="fileUploadForm.trackname.$error.required" class="error">*required</i> </div> </div> <div class="form-group row"> <label for="genre" class="col-sm-2 col-sm-offset-2 control-label"> Genre: </label> <div class="col-sm-6"> <input class="short_field" type="text" class="form-control" name="genre" ng-model="upload.genre" placeholder="What is your sound?" size="24"> </div> </div> <div class="form-group row"> <label for="File" class="col-sm-2 col-sm-offset-2 control-label">Song:</label> <div class="col-sm-6"> <input class="short_field" type="file" ngf-select ng-model="audioFile" name="file" accept="audio/*" ngf-max-size="9MB" required ngf-model-invalid="errorFile"> <i ng-show="fileUploadForm.file.$error.required" class="error">*required</i> </div> </div> <div class="form-group row"> <label for="File" class="col-sm-2 col-sm-offset-2 control-label">Image:</label> <div class="col-sm-6"> <input class="short_field" type="file" ngf-select ng-model="picFile" name="picfile" accept="image/*" ngf-max-size="2MB" ngf-model-invalid="errorImage"> <i ng-show="fileUploadForm.file.$error.maxSize" class="error">File too large {{errorFile.size / 1000000|number:1}}MB: max 9MB</i> <i ng-show="fileUploadForm.file.$error.maxSize" class="error">File too large {{errorImage.size / 1000000|number:1}}MB: max 2MB</i> </div> </div> <button ng-click="file = null" ng-show="file" class="btn">Remove</button> <br> <div class="form-group row"> <div class="col-sm-offset-4 col-sm-10"> <button ng-disabled="!fileUploadForm.$valid" ng-click="upload.uploadSong(audioFile, picFile)" class="btn">Upload</button> </div> </div> <div class="row"> <div class="col-sm-offset-4 col-sm-10"> <span class="progress" ng-show="audioFile.progress >= 0"> <div style="width:{{audioFile.progress}}%" ng-bind="audioFile.progress + \'%\'"> </div> </span> </div> </div> <span ng-show="audioFile.result">Upload Successful</span> <span class="err" ng-show="errorMsg">{{errorMsg}}</span> </form></div> <br>  '),a.put("views/user_account.html",'<div ng-include="\'views/navbar.html\'"></div> <h1>User Account<h1> <div> <flash:messages></flash:messages> </div> <button id="Click" ng-click="user.displayStreamDetails()" class="btn">Click</button> <div ng-repeat="track in user.returnData"> <p>{{track.track_id}}: {{track.total_plays}}</p> </div> <button id="Pay" ng-click="user.pay()" class="btn">Pay</button></h1></h1>')}]);